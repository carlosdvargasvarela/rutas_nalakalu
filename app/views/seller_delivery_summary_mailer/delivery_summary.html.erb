<!-- app/views/seller_delivery_summary_mailer/delivery_summary.html.erb -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <style>
      .mail-body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; color: #1e293b; max-width: 800px; margin: 0 auto; background-color: #f1f5f9; padding: 20px; }
      .main-container { background: white; border-radius: 12px; overflow: hidden; }
      .header { background-color: #4f46e5; color: white; padding: 30px; text-align: center; }
      .content { padding: 30px; }
      .summary-box { background: #eef2ff; border-radius: 8px; padding: 20px; margin-bottom: 30px; border: 1px solid #e0e7ff; }
      .delivery-card { border: 1px solid #e2e8f0; border-radius: 10px; margin-bottom: 20px; padding: 20px; background: #ffffff; }
      .card-err { border-left: 5px solid #ef4444; background: #fffafb; }
      .order-title { font-size: 18px; font-weight: 800; color: #1e293b; }
      .info-grid { display: table; width: 100%; margin: 15px 0; }
      .info-col { display: table-cell; width: 50%; vertical-align: top; font-size: 13px; }
      .label { display: block; font-size: 11px; color: #64748b; text-transform: uppercase; font-weight: 700; margin-bottom: 4px; }
      .err-box { background: #fef2f2; border-radius: 6px; padding: 12px; margin-top: 15px; }
      .err-item { color: #b91c1c; font-size: 12px; margin-bottom: 4px; }
      .btn-edit { display: inline-block; background: #4f46e5; color: white !important; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 13px; }
      .btn-err { background: #ef4444; }
      .footer { text-align: center; padding: 20px; color: #94a3b8; font-size: 12px; }
    </style>
  </head>
  <body class="mail-body">
    <div class="main-container">
      <div class="header">
        <h1 style="margin:0">üì¶ Tus Entregas Programadas</h1>
        <p style="margin:5px 0 0; opacity:0.8"><%= l(Date.today, format: :long) %></p>
      </div>
      <div class="content">
        <p>Hola <strong><%= @seller.name %></strong>,</p>
        <div class="summary-box">
          <table width="100%">
            <tr>
              <td align="center">
                <span style="font-size:24px; font-weight:800; color:#4f46e5"><%= @summary[:total_count] %></span><br>
                <span style="font-size:11px; color:#64748b; text-transform:uppercase">Entregas</span>
              </td>
              <td align="center" style="border-left: 1px solid #c7d2fe">
                <span style="font-size:24px; font-weight:800; color:<%= @summary[:with_errors] > 0 ? '#ef4444' : '#4f46e5' %>">
                  <%= @summary[:with_errors] %>
                </span><br>
                <span style="font-size:11px; color:#64748b; text-transform:uppercase">Con Errores</span>
              </td>
            </tr>
          </table>
        </div>
        <% @deliveries_by_date.each do |date, deliveries| %>
          <h3 style="color:#475569; font-size:14px; border-bottom:1px solid #e2e8f0; padding-bottom:5px">
            üìÖ <%= l(date, format: :long) %>
          </h3>
          <% deliveries.each do |delivery| %>
            <% detector = Deliveries::ErrorDetector.new(delivery) %>
            <div class="delivery-card <%= 'card-err' if detector.has_errors? %>">
              <div style="display:flex; justify-content:space-between">
                <span class="order-title">Pedido #<%= delivery.order.number %></span>
                <% if detector.has_errors? %>
                  <span style="color:#ef4444; font-size:12px; font-weight:700">‚ö†Ô∏è REQUIERE CORRECCI√ìN</span>
                <% end %>
              </div>
              <div class="info-grid">
                <div class="info-col">
                  <span class="label">Cliente</span>
                  <strong><%= delivery.order.client.name %></strong>
                </div>
                <div class="info-col">
                  <span class="label">Direcci√≥n</span>
                  <%= delivery.delivery_address&.address&.truncate(50) || "No especificada" %>
                </div>
              </div>
              <% if detector.has_errors? %>
                <div class="err-box">
                  <% detector.errors.each do |err| %>
                    <div class="err-item">‚Ä¢ <%= err[:message] %></div>
                  <% end %>
                </div>
              <% end %>
              <div style="margin-top:15px; text-align:right">
                <%= link_to "Corregir / Editar", edit_delivery_url(delivery), class: "btn-edit #{'btn-err' if detector.has_errors?}" %>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
      <div class="footer">
        <p>Sistema de Rutas NaLakalu ‚Ä¢ Por favor no respondas a este correo.</p>
      </div>
    </div>
  </body>
</html>