<%# app/views/production/delivery_plans/index.html.erb %>
<div class="container-fluid mt-3 px-2 px-md-4">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3 gap-2">
    <div>
      <h3 class="mb-1">ðŸ“¦ BitÃ¡cora de Carga</h3>
      <p class="text-muted mb-0"><%= l @date, format: :long %></p>
    </div>
    <%= form_with url: production_delivery_plans_path, method: :get, class: "d-flex gap-2" do %>
      <%= date_field_tag :date, @date, class: "form-control", style: "max-width: 200px;", onchange: "this.form.submit()" %>
      <%= link_to "Hoy", production_delivery_plans_path(date: Date.current), class: "btn btn-outline-secondary" %>
    <% end %>
  </div>
  <% if @delivery_plans.empty? %>
    <div class="alert alert-info text-center" role="alert">
      <i class="bi bi-info-circle me-2"></i>
      No hay planes de entrega programados para esta fecha.
    </div>
  <% else %>
    <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-3">
      <% @delivery_plans.each do |plan| %>
        <div class="col">
          <div class="card shadow-sm h-100 border-0">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center py-2">
              <div>
                <h6 class="mb-0">Plan #<%= plan.id %></h6>
                <small><%= plan.driver&.full_name || "Sin Asignar" %></small>
              </div>
              <span class="badge bg-light text-primary"><%= plan.truck&.humanize || "N/A" %></span>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center mb-1">
                  <small class="text-muted">Estado de Carga</small>
                  <%= load_status_badge(plan.load_status) %>
                </div>
                <div class="progress" style="height: 24px;">
                  <div class="progress-bar bg-success progress-bar-striped" 
                       role="progressbar" 
                       style="width: <%= plan.load_percentage %>%" 
                       aria-valuenow="<%= plan.load_percentage %>" 
                       aria-valuemin="0" 
                       aria-valuemax="100">
                    <strong><%= plan.load_percentage %>%</strong>
                  </div>
                </div>
              </div>
              <div class="row text-center mb-3">
                <div class="col-4">
                  <div class="border rounded py-2">
                    <i class="bi bi-truck text-primary"></i>
                    <div class="fw-bold"><%= plan.deliveries.count %></div>
                    <small class="text-muted">Entregas</small>
                  </div>
                </div>
                <div class="col-4">
                  <div class="border rounded py-2">
                    <i class="bi bi-box-seam text-info"></i>
                    <div class="fw-bold"><%= plan.load_stats[:total_items] %></div>
                    <small class="text-muted">Productos</small>
                  </div>
                </div>
                <div class="col-4">
                  <div class="border rounded py-2">
                    <i class="bi bi-check-circle text-success"></i>
                    <div class="fw-bold"><%= plan.load_stats[:loaded_items] %></div>
                    <small class="text-muted">Cargados</small>
                  </div>
                </div>
              </div>
              <%= link_to loading_production_delivery_plan_path(plan), class: "btn btn-primary w-100" do %>
                <i class="bi bi-clipboard-check me-2"></i>Ver BitÃ¡cora
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>