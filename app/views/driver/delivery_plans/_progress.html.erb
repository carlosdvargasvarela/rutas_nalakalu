<%# app/views/driver/delivery_plans/_progress.html.erb %>
<% total        = assignments.size %>
<% completed    = assignments.count(&:completed?) %>
<% en_route     = assignments.count(&:en_route?) %>
<% pending      = assignments.count(&:pending?) %>
<% percentage   = total.zero? ? 0 : ((completed.to_f / total) * 100).round %>
<div class="card shadow-sm mb-3">
  <div class="card-body">
    <h5 class="card-title mb-3">
      <i class="bi bi-activity me-2"></i>
      Progreso de la ruta
    </h5>
    <div class="progress mb-2" role="progressbar" aria-label="Progreso de entregas"
         aria-valuemin="0" aria-valuemax="100"
    >
      <div class="progress-bar <%= percentage == 100 ? 'bg-success' : (percentage >= 50 ? 'bg-info' : 'bg-primary') %>"
           data-driver-plan-target="progressBar"
           style="width: <%= percentage %>%"
           aria-valuenow="<%= percentage %>">
        <%= percentage %>%
      </div>
    </div>
    <div class="small text-muted">
      Completadas: <span data-driver-plan-target="completedCount"><%= completed %></span> /
      En ruta: <span data-driver-plan-target="enRouteCount"><%= en_route %></span> /
      Pendientes: <span data-driver-plan-target="pendingCount"><%= pending %></span>
      (Total: <span data-driver-plan-target="totalCount"><%= total %></span>)
    </div>
  </div>
</div>