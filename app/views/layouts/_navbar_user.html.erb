<!-- Navbar menu partial -->
<ul class="navbar-nav ms-auto mb-2 mb-lg-0">
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-person-circle me-1"></i>
      <span class="d-none d-lg-inline"><%= current_user.name %> (<%= current_user.display_role %>)</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
      <li>
        <%= link_to edit_user_registration_path, class: "dropdown-item" do %>
          <i class="bi bi-person-gear me-2"></i>
          Mi perfil
        <% end %>
      </li>
      <% if current_user.admin? %>
        <li>
          <%= link_to new_admin_user_path, class: "dropdown-item" do %>
            <i class="bi bi-person-plus-fill me-2"></i>
            Agregar usuario
          <% end %>
        </li>
        <li>
          <%= link_to admin_users_path, class: "dropdown-item" do %>
            <i class="bi bi-people me-2"></i>
            Lista de usuarios
          <% end %>
        </li>
      <% end %>
      <li><hr class="dropdown-divider"></li>
      <li>
        <%= button_to destroy_user_session_path, method: :delete, class: "dropdown-item text-danger", form: { data: { turbo: false } } do %>
          <i class="bi bi-box-arrow-right me-2"></i>
          Cerrar sesi√≥n
        <% end %>
      </li>
    </ul>
  </li>
  <li class="nav-item dropdown">
    <a class="nav-link position-relative" href="#" id="notificationsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-bell"></i>
      <% unread_count = current_user.unread_notifications_count %>
      <% if unread_count > 0 %>
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
          <%= unread_count %>
        </span>
      <% end %>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notificationsDropdown" style="min-width: 350px;">
      <% current_user.notifications.recent.limit(10).each do |notification| %>
        <li class="<%= 'bg-light' unless notification.read %>">
          <a class="dropdown-item d-flex justify-content-between align-items-center" href="<%= notification.target_path %>">
            <span>
              <%= notification.message %>
              <br>
              <small class="text-muted"><%= l(notification.created_at, format: :short) %></small>
            </span>
            <% unless notification.read %>
              <span class="badge bg-primary ms-2">Nuevo</span>
            <% end %>
          </a>
        </li>
      <% end %>
      <li>
        <hr class="dropdown-divider">
      </li>
      <li>
        <%= link_to "Ver todas las notificaciones", notifications_path, class: "dropdown-item text-center" %>
      </li>
    </ul>
  </li>
</ul>