<%# app/views/deliveries/_client_fields.html.erb %>
<div class="card border-0 shadow-sm mb-4 rounded-4 overflow-hidden">
  <div class="card-header bg-gradient text-white py-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <div class="d-flex align-items-center">
      <div class="bg-white bg-opacity-25 rounded-circle p-2 me-3">
        <i class="bi bi-person-fill fs-5"></i>
      </div>
      <div>
        <h5 class="mb-0 fw-bold">Cliente</h5>
        <small class="opacity-75">Seleccione o cree un nuevo cliente</small>
      </div>
    </div>
  </div>
  <div class="card-body p-4">
    <div class="row g-4">
      <div class="col-lg-8">
        <label class="form-label fw-semibold">
          <i class="bi bi-person me-2 text-primary"></i>Seleccionar cliente
        </label>
        <%= select_tag :client_id,
          options_from_collection_for_select(clients, :id, :name, f.object.order&.client_id),
          class: "form-select form-select-lg rounded-3",
          data: { "delivery-form-target": "clientSelect", action: "change->delivery-form#clientChanged" } %>
      </div>
      <div class="col-lg-4 d-flex align-items-end">
        <% unless f.object.persisted? %>
          <button type="button"
                  class="btn btn-outline-primary btn-lg w-100 rounded-3"
                  data-action="click->delivery-form#toggleNewClientFields"
            data-delivery-form-target="addClientButton">
            <i class="bi bi-person-plus-fill me-2"></i>Nuevo cliente
          </button>
        <% end %>
      </div>
    </div>
    
    <% unless f.object.persisted? %>
      <div data-delivery-form-target="newClientFields" class="mt-4" style="display:none;">
        <div class="card border-primary border-2 rounded-4 overflow-hidden">
          <div class="card-header bg-primary bg-gradient text-white py-3">
            <div class="d-flex justify-content-between align-items-center">
              <div class="d-flex align-items-center">
                <i class="bi bi-person-fill-add me-2 fs-5"></i>
                <span class="fw-bold">Datos del nuevo cliente</span>
              </div>
              <button type="button" class="btn btn-sm rounded-circle p-0 nalakalu-close-btn"
                      style="width: 36px; height: 36px; background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); transition: all 0.2s ease;"
                      data-action="click->delivery-form#cancelNewClientFields"
                      onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'; this.style.transform='rotate(90deg)'"
                      onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'; this.style.transform='rotate(0deg)'">
                <i class="bi bi-x-lg" style="font-size: 1.1rem;"></i>
              </button>
            </div>
          </div>
          <div class="card-body p-4 bg-light">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label fw-semibold">
                  <i class="bi bi-person me-2"></i>Nombre completo
                </label>
                <%= text_field_tag "client[name]", nil, class:"form-control form-control-lg rounded-3", placeholder:"Ingrese el nombre completo" %>
              </div>
              <div class="col-md-3">
                <label class="form-label fw-semibold">
                  <i class="bi bi-telephone me-2"></i>Teléfono
                </label>
                <%= text_field_tag "client[phone]", nil, class:"form-control form-control-lg rounded-3", placeholder:"Teléfono" %>
              </div>
              <div class="col-md-3">
                <label class="form-label fw-semibold">
                  <i class="bi bi-envelope me-2"></i>Correo
                </label>
                <%= email_field_tag "client[email]", nil, class:"form-control form-control-lg rounded-3", placeholder:"correo@ejemplo.com" %>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>