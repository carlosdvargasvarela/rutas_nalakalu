<%# app/views/deliveries/_address_fields.html.erb %>
<div class="card border-0 shadow-sm mb-4 rounded-4 overflow-hidden">
  <div class="card-header bg-gradient text-white py-3" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
    <div class="d-flex align-items-center">
      <div class="bg-white bg-opacity-25 rounded-circle p-2 me-3">
        <i class="bi bi-geo-alt-fill fs-5"></i>
      </div>
      <div>
        <h5 class="mb-0 fw-bold">Dirección</h5>
        <small class="opacity-75">Seleccione o agregue una nueva dirección</small>
      </div>
    </div>
  </div>
  <div class="card-body p-4">
    <div class="row g-4">
      <div class="col-lg-8">
        <label class="form-label fw-semibold">
          <i class="bi bi-geo-alt me-2 text-info"></i>Seleccionar dirección
        </label>
        <%= f.select :delivery_address_id,
            options_from_collection_for_select(addresses, :id, :address, f.object.delivery_address_id),
            { prompt: "Selecciona una dirección" },
            class: "form-select form-select-lg rounded-3",
            data: { controller: "tom-select",
                    "delivery-form-target": "addressSelect",
                    action: "change->delivery-form#addressChanged" } %>
      </div>
      <div class="col-lg-4 d-flex align-items-end">
        <button type="button"
                class="btn btn-outline-info btn-lg w-100 rounded-3"
                data-action="click->delivery-form#toggleNewAddressFields">
          <i class="bi bi-geo-alt-fill me-2"></i>Nueva dirección
        </button>
      </div>
    </div>
    
    <div data-delivery-form-target="newAddressFields"
         data-controller="address-autocomplete"
         data-address-autocomplete-api-key-value="<%= ENV['GOOGLE_MAPS_API_KEY'] %>"
         class="mt-4" style="display:none;">
      <%= render "deliveries/upsert_partials/address_autocomplete_fields", delivery: f.object, client: @client %>
    </div>
  </div>
</div>