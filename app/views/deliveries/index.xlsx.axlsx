# app/views/deliveries/index.xlsx.axlsx

wb = xlsx_package.workbook
wb.add_worksheet(name: "Entregas") do |sheet|
  sheet.add_row [
    "Fecha de entrega", "Pedido", "Producto", "Cantidad", "Vendedor", "Cliente", "Direcci√≥n", "Estado", "Tipo"
  ]
|  
  @all_deliveries.each do |delivery|
    # üîπ CAMBIO: Excluir delivery_items que est√©n en estado "archived" o cuya delivery est√© archivada
    next if delivery.archived?
    
    delivery.delivery_items.each do |delivery_item|
      # üîπ Si el delivery_item tiene un estado "archived", lo saltamos
      # (Nota: DeliveryItem no tiene enum :archived, pero si lo tuviera, aqu√≠ ir√≠a)
      # Por ahora, solo verificamos que la delivery no est√© archivada
      
      sheet.add_row [
        delivery.delivery_date.strftime("%d/%m/%Y"),
        delivery.order.number,
        delivery_item.order_item.product,
        delivery_item.quantity,
        delivery.order.seller.seller_code,
        delivery.order.client.name,
        delivery.delivery_address.address,
        delivery.display_status,
        delivery.delivery_type_humanize
      ]
    end
  end
end