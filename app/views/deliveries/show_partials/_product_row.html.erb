<tr class="<%= 'table-warning' if item.order_item.notes_open? %>">
  <!-- Producto -->
  <td>
    <strong><%= item.order_item.product %></strong>
    <% if item.order_item.notes_open? %>
      <span class="ms-2 badge bg-warning text-dark">
        <i class="bi bi-exclamation-triangle-fill"></i> Nota de producción abierta
      </span>
    <% end %>
  </td>
  <!-- Cantidad -->
  <td>
    <span class="badge bg-secondary"><%= item.quantity %></span>
  </td>
  <!-- Observaciones -->
  <td>
    <% if item.order_item.notes.present? %>
      <span class="text-muted"><i class="bi bi-info-circle"></i> <%= item.order_item.notes %></span>
    <% else %>
      <span class="text-muted">N/A</span>
    <% end %>
    <% if item.order_item.notes_open? %>
      <div class="small text-warning mt-1">
        <i class="bi bi-tools"></i> Producción reporta pendientes en este producto.
      </div>
    <% end %>
  </td>
  <!-- Caso Servicio -->
  <td>
    <% if item.service_case? %>
      <span class="badge bg-warning text-dark">Sí</span>
    <% else %>
      <span class="badge bg-secondary">No</span>
    <% end %>
  </td>
  <!-- Estado -->
  <td>
    <span class="badge bg-<%= delivery_item_status_color(item.status) %>">
      <%= item.display_status %>
    </span>
  </td>
  <!-- Notas de producción -->
  <% unless current_user.seller? %>
    <td style="min-width: 300px;">
      <%= render "order_item_notes/list", item: item.order_item %>
    </td>
  <% end %>
  <!-- Acciones -->
  <td>
    <% if item.order_item.notes_open? && current_user.seller? %>
      <div class="alert alert-warning py-1 px-2 mb-2">
        <i class="bi bi-exclamation-octagon"></i> Revise notas antes de confirmar.
      </div>
    <% end %>
    <% if delivery.needs_approval? && !delivery.approved? %>
      <span class="text-muted"><i class="bi bi-lock"></i> Bloqueado</span>
    <% elsif item.rescheduled? %>
      <span class="text-warning"><i class="bi bi-calendar-x"></i> Reagendado</span>
    <% elsif item.delivered? %>
      <span class="text-success"><i class="bi bi-check2-circle"></i> Entregado</span>
    <% elsif item.cancelled? %>
      <span class="text-danger"><i class="bi bi-x-circle"></i> Cancelado</span>
    <% else %>
      <% if item.pending? %>
        <%= button_to confirm_delivery_item_path(item), method: :patch,
          class: "btn btn-primary btn-sm me-1" do %>
          <i class="bi bi-check-circle"></i> Confirmar
        <% end %>
      <% end %>
      <%= button_to mark_delivered_delivery_item_path(item), method: :patch,
        class: "btn btn-success btn-sm me-1",
        data: { turbo_confirm: "¿Marcar este producto como entregado?" } do %>
        <i class="bi bi-check2-circle"></i> Entregado
      <% end %>
      <button type="button"
              class="btn btn-warning btn-sm me-1"
              data-bs-toggle="modal"
              data-bs-target="#rescheduleModal<%= item.id %>">
        <i class="bi bi-calendar2-plus"></i> Reagendar
      </button>
      <%= button_to cancel_delivery_item_path(item), method: :patch,
        class: "btn btn-danger btn-sm",
        data: { turbo_confirm: "¿Está seguro?" } do %>
        <i class="bi bi-x-circle"></i> Cancelar
      <% end %>
    <% end %>
  </td>
</tr>