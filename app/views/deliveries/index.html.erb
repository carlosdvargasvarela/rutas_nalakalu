<h1>Listado de Entregas</h1>

<%= search_form_for @q, url: deliveries_path, method: :get do |f| %>
  <%= f.label :order_client_name_cont, "Cliente" %>
  <%= f.search_field :order_client_name_cont %>
  <%= f.label :delivery_date_gteq, "Desde" %>
  <%= f.date_field :delivery_date_gteq %>
  <%= f.label :delivery_date_lteq, "Hasta" %>
  <%= f.date_field :delivery_date_lteq %>
  <%= f.submit "Buscar" %>
<% end %>

<div class="mb-3">
  <%= link_to "Ver solo Casos de Servicio", service_cases_deliveries_path, class: "btn btn-info btn-sm" %>
  <%= link_to "Ver todas las Entregas", deliveries_path, class: "btn btn-secondary btn-sm" %>
</div>

<% if @deliveries.any? %>
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th>Fecha Entrega</th>
        <th>Pedido</th>
        <th>Cliente</th>
        <th>Dirección</th>
        <th>Contacto</th>
        <th>Items</th>
        <th>Caso Servicio</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <% @deliveries.each do |delivery| %>
        <tr>
          <td><%= l delivery.delivery_date, format: :short %></td>
          <td><%= delivery.order.number %></td>
          <td><%= delivery.order.client.name %></td>
          <td><%= delivery.delivery_address.address %></td>
          <td><%= delivery.contact_name %></td>
          <td>
            <ul>
              <% delivery.delivery_items.each do |item| %>
                <li><%= item.quantity_delivered %> x <%= item.order_item.product %></li>
              <% end %>
            </ul>
          </td>
          <td><%= delivery.has_service_cases? ? 'Sí' : 'No' %></td>
          <td><%= link_to "Ver", delivery_path(delivery), class: "btn btn-sm btn-outline-primary" %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <%= paginate @deliveries %>
<% else %>
  <p>No hay entregas para mostrar.</p>
<% end %>