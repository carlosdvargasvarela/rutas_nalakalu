<div class="card shadow-sm mb-4">
  <div class="card-header bg-light">
    <i class="bi bi-geo-alt-fill me-2 text-success"></i><strong>Dirección del mandado</strong>
  </div>
  <div class="card-body">
    <div class="alert alert-warning mb-3">
      <i class="bi bi-exclamation-triangle me-2"></i>
      <strong>Mandados internos:</strong> Estas direcciones suelen ser ubicaciones internas de la empresa (bodegas, oficinas, talleres, etc.)
    </div>
    
    <div data-controller="internal-address-autocomplete"
         data-internal-address-autocomplete-api-key-value="<%= ENV['GOOGLE_MAPS_API_KEY'] %>">
      
      <div class="row g-3">
        <div class="col-md-8">
          <%= label_tag "delivery_address[address]", "Dirección", class: "form-label fw-bold" %>
          <%= text_field_tag "delivery_address[address]", nil,
              placeholder: "Ej: Bodega Principal, Oficinas Centrales, Taller de Carpintería...",
              class: "form-control form-control-lg",
              required: true,
              data: { 
                "internal-address-autocomplete-target": "input",
                action: "input->internal-delivery-form#validateAddress"
              } %>
          <div class="form-text">
            <i class="bi bi-info-circle me-1"></i>
            Puede buscar en Google Maps o escribir una dirección informal
          </div>
        </div>
        <div class="col-md-4">
          <%= label_tag "delivery_address[description]", "Referencia", class: "form-label fw-bold" %>
          <%= text_field_tag "delivery_address[description]", nil,
              placeholder: "Ej: Puerta trasera, 2do piso",
              class: "form-control form-control-lg",
              data: { 
                "internal-address-autocomplete-target": "description"
              } %>
        </div>
      </div>

      <!-- Mapa pequeño -->
      <div class="mt-3">
        <div data-internal-address-autocomplete-target="map"
             style="height: 300px;"
             class="border rounded"></div>
      </div>

      <!-- Coordenadas (colapsable) -->
      <details class="mt-3">
        <summary class="btn btn-outline-secondary btn-sm">
          <i class="bi bi-gear me-1"></i> Coordenadas y detalles técnicos
        </summary>
        
        <div class="card bg-light mt-2">
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-4">
                <%= label_tag "delivery_address[latitude]", "Latitud", class: "form-label small" %>
                <%= number_field_tag "delivery_address[latitude]", nil,
                    step: "any",
                    class: "form-control form-control-sm", 
                    placeholder: "9.9281",
                    data: { 
                      "internal-address-autocomplete-target": "lat",
                      action: "change->internal-address-autocomplete#updateMapFromCoordinates"
                    } %>
              </div>
              <div class="col-md-4">
                <%= label_tag "delivery_address[longitude]", "Longitud", class: "form-label small" %>
                <%= number_field_tag "delivery_address[longitude]", nil,
                    step: "any",
                    class: "form-control form-control-sm", 
                    placeholder: "-84.0907",
                    data: { 
                      "internal-address-autocomplete-target": "lng",
                      action: "change->internal-address-autocomplete#updateMapFromCoordinates"
                    } %>
              </div>
              <div class="col-md-4">
                <%= label_tag "delivery_address[plus_code]", "Plus Code", class: "form-label small" %>
                <%= text_field_tag "delivery_address[plus_code]", nil,
                    class: "form-control form-control-sm", 
                    placeholder: "W2H5+2Q San José",
                    data: { 
                      "internal-address-autocomplete-target": "plus"
                    } %>
              </div>
            </div>
            <div class="form-text mt-2">
              <i class="bi bi-info-circle me-1"></i>
              Estos campos se llenan automáticamente al buscar en Google Maps
            </div>
          </div>
        </div>
      </details>

    </div>
  </div>
</div>