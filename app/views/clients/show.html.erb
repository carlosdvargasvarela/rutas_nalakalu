<!-- app/views/clients/show.html.erb -->
<div class="d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3">
  <h3 class="mb-0"><%= @client.name %></h3>
  <div class="d-flex gap-2">
    <% if policy(@client).update? %>
      <%= link_to raw('<i class="bi bi-pencil"></i> Editar'), edit_client_path(@client), class: "btn btn-outline-secondary" %>
    <% end %>
    <%= link_to "Volver", clients_path, class: "btn btn-secondary" %>
  </div>
</div>

<div class="row g-3">
  <div class="col-lg-5">
    <div class="card h-100">
      <div class="card-header">Información</div>
      <div class="card-body">
        <p class="mb-1"><strong>Teléfono:</strong> <%= @client.phone.presence || "-" %></p>
        <p class="mb-1"><strong>Correo:</strong> <%= @client.email.presence || "-" %></p>
        <p class="mb-0 text-muted"><small>Creado: <%= l(@client.created_at, format: :short) %></small></p>
      </div>
    </div>
    <% if policy(@client).destroy? %>
      <div class="mt-3">
        <%= link_to raw('<i class="bi bi-trash"></i> Eliminar cliente'), client_path(@client),
            data: { turbo_method: :delete, turbo_confirm: "¿Seguro que deseas eliminar este cliente?" },
            class: "btn btn-outline-danger w-100" %>
      </div>
    <% end %>
  </div>

  <div class="col-lg-7">
    <div class="card mb-3">
      <div class="card-header">Direcciones de entrega</div>
      <div class="card-body">
        <% if @delivery_addresses.any? %>
          <div class="row row-cols-1 row-cols-md-1 g-2">
            <% @delivery_addresses.each do |addr| %>
              <div class="col">
                <div class="border rounded p-2">
                  <div class="fw-semibold"><%= addr.address %></div>
                  <div class="text-muted"><small><%= addr.description.presence || "Sin descripción" %></small></div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-center text-muted">
            <i class="bi bi-geo-alt fs-3 d-block mb-2"></i>
            No hay direcciones registradas.
          </div>
        <% end %>
      </div>
    </div>

    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Pedidos recientes</span>
        <%= link_to "Ver todos", orders_path(q: { client_id_eq: @client.id }), class: "btn btn-sm btn-outline-primary" %>
      </div>
      <div class="card-body p-0">
        <% if @orders.any? %>
          <div class="table-responsive">
            <table class="table table-sm align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th>Número</th>
                  <th>Vendedor</th>
                  <th>Estado</th>
                  <th>Fecha</th>
                </tr>
              </thead>
              <tbody>
                <% @orders.each do |order| %>
                  <tr>
                    <td><%= link_to order.number, order_path(order), class: "link-primary" %></td>
                    <td><%= order.seller.name %> (<%= order.seller.seller_code %>)</td>
                    <td><span class="badge text-bg-secondary"><%= order.status.humanize %></span></td>
                    <td><%= l(order.created_at, format: :short) %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
          <div class="p-2 d-flex justify-content-center">
            <%= paginate @orders, param_name: :orders_page %>
          </div>
        <% else %>
          <div class="p-4 text-center text-muted">
            <i class="bi bi-box-seam fs-3 d-block mb-2"></i>
            Sin pedidos registrados.
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>