<!-- app/views/delivery_plans/show_partials/_map.html.erb -->
<div class="card shadow-sm mb-4">
  <div class="card-header bg-light d-flex justify-content-between align-items-center">
    <span class="fw-bold">
      <i class="bi bi-map me-2"></i> Mapa de Ruta
    </span>
    <span class="badge bg-primary">
      <%= assignments.count %> paradas
    </span>
  </div>
  <div class="card-body p-0">
    <div
      data-controller="delivery-plan-map"
      data-delivery-plan-map-api-key-value="<%= ENV['GOOGLE_MAPS_API_KEY'] %>"
      data-delivery-plan-map-points-value="<%= assignments.map { |a|
        addr = a.delivery.delivery_address
        {
          id: a.id,
          stop_order: a.stop_order,
          address: addr.address,
          lat: addr.latitude,
          lng: addr.longitude,
          order_number: a.delivery.order.number,
          client: a.delivery.order.client.name,
          date: l(a.delivery.delivery_date)
        }
      }.to_json %>">
      <div style="height:500px" class="border-0" data-delivery-plan-map-target="map"></div>
    </div>
  </div>
</div>