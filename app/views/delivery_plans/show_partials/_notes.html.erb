<% if delivery.delivery_items.any? %>
    <div class="modal fade" id="notaEntregaModal<%= delivery.id %>" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="bi bi-sticky me-2"></i> Nota - Pedido <%= delivery.order.number %>
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <%= form_with url: bulk_add_notes_delivery_items_path, method: :post, local: true do |f| %>
              <%= hidden_field_tag :delivery_id, delivery.id %>
              <div class="mb-3">
                <%= label_tag :target, "Aplicar nota a:", class: "form-label" %>
                <%= select_tag :target,
                      options_for_select([["ðŸ“Œ General (todos los productos)", "all"]] +
                      delivery.delivery_items.map { |i| ["#{i.order_item.product} (#{i.quantity})", i.id] }),
                      class: "form-select" %>
              </div>
              <div class="mb-3">
                <%= label_tag "note[body]", "Detalle de la nota", class: "form-label" %>
                <%= text_area_tag "note[body]", nil, class: "form-control",
                      rows: 4, placeholder: "Escribe aquÃ­ la nota..." %>
              </div>
              <div class="d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <%= f.submit "Guardar Nota", class: "btn btn-primary" %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>